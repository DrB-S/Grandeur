manifest {
  name                            = 'Grandeur'
  author                          = 'Erin Young'
  homePage                        = 'https://github.com/UPHL-BioNGS/Grandeur'
  mainScript                      = 'main.nf'
  version                         = '4.0.20240124'
  defaultBranch                   = 'main'
  description                     = 'Grandeur is short-read de novo assembly pipeline with serotyping.'
}

//########## Setting Profiles ##########

profiles {
  docker {
    docker.enabled         = true
    conda.enabled          = false
    singularity.enabled    = false
    podman.enabled         = false
    shifter.enabled        = false
    charliecloud.enabled   = false
    apptainer.enabled      = false
    docker.runOptions      = '-u $(id -u):$(id -g)'
  }
  singularity {
    singularity.enabled    = true
    singularity.autoMounts = true
    conda.enabled          = false
    docker.enabled         = false
    podman.enabled         = false
    shifter.enabled        = false
    charliecloud.enabled   = false
    apptainer.enabled      = false
  }
  msa {
    params.msa                    = true
    }
  just_msa {
    params.msa                    = true
    params.extras                 = false
    }
  test0 {
    params.sra_accessions         = ["SRR11725329", "SRR13643280", "SRR14436834", "SRR14634837", "SRR7738178", "SRR7889058"]  
    }
  test1 {
    params.sra_accessions         = ["SRR11725329", "SRR13643280", "SRR14436834", "SRR14634837", "SRR7738178", "SRR7889058"]
    params.current_datasets       = false
    params.mash_db                = false
    }
  test2 {
    params.sra_accessions         = ["SRR22314961", "SRR22314960", "SRR22314959", "SRR22314958" ]
    params.msa                    = true
    }
  test3 {
    params.sra_accessions         = ["SRR22314961", "SRR22314960", "SRR22314959", "SRR22314958" ]
    params.msa                    = true
    params.extras                 = false
    }
  test4 {
    params.sra_accessions         = ["SRR22314961", "SRR22314960", "SRR22314959", "SRR22314958" ]
    params.msa                    = true
    params.current_datasets       = false
    params.mash_db                = false
    }
  test5 {
    params.sra_accessions         = ["SRR22314961", "SRR22314960", "SRR22314959", "SRR22314958" ]
    params.msa                    = true
    params.fastani_include        = false
    }
  uphl {
    includeConfig './configs/UPHL.config'
    }
}

process {
    maxRetries    = 1
    maxErrors     = '-1'

    withLabel:process_single {
      cpus   = { 1 }
      memory = { 6.GB * task.attempt }
      time   = { 10.m * task.attempt }
    }
    withLabel:process_low {
        cpus   = { 2     * task.attempt }
        memory = { 12.GB * task.attempt }
        time   = { 2.h   * task.attempt }
    }
    withLabel:process_medium {
        cpus   = { 6     * task.attempt }
        memory = { 36.GB * task.attempt }
        time   = { 4.h   * task.attempt }
    }
    withLabel:process_high {
        cpus   = { 12    * task.attempt }
        memory = { 72.GB * task.attempt }
        time   = { 16.h  * task.attempt }
    }
    withLabel:process_long {
        time   = { 20.h  * task.attempt }
    }
    withLabel:process_high_memory {
        memory = { 200.GB * task.attempt }
    }
}
